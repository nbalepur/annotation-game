<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    /* Custom Styling */
    body, html {
      height: 100%;
      margin: 0;
    }

    /* Flexbox parent container */
    .flex-container {
      display: flex;
      flex-direction: column;
      height: 100vh; /* Full height of viewport */
    }

    .input-group {
      height: auto; /* Elements will define their own height */
    }

    /* Allow #doc-viewer to take up the remaining space */
    #doc-viewer {
      flex-grow: 1; /* This makes it take up the remaining height */
      display: flex;
      flex-direction: column;
    }

    /* Ensure the content inside #doc-viewer also takes the remaining height */
    #doc-viewer-content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .view-page-header.card-header {
      background-color: #dea1f7;
    }

    /* Ensure iframe takes up all available space in #doc-viewer-content */
    iframe {
      flex-grow: 1;
      width: 100%;
      border: none;
    }
  </style>
</head>

<body>

  <div class="flex-container h-100">
    <div class="input-group mb-3" id="calculator-tool">
      <button type="button" class="btn btn-danger" id="calc-expression-btn" onclick="calculate()">
        <i class="fas fa-calculator"></i>
      </button>
      <input type="text" id="calc-expression" class="form-control" placeholder="Calculate a math equation (c)" />
      <button type="button" class="btn btn-white disabled" style="pointer-events: none;" id="calc-expression-result">
        Result: <span id="calc-result" class="fw-bold text-danger" style="pointer-events: auto; user-select: text;"></span>
      </button>
    </div>

    <div class="input-group mb-3" id="google-tool">
      <button type="button" id="google-query-btn" class="btn btn-primary" onclick="web_search()">
        <i class="fas fa-globe"></i>
      </button>
      <input type="text" id="google-query" class="form-control" placeholder="Search for Wikipedia pages (g)" />
    </div>

    <div class="card bg-faded" id="doc-viewer">
      <div class="card-header view-page-header" id="view-page-header">
        <h6>Wikipedia Page</h6>
      </div>

      <div style="padding-left: 10px; padding-right: 10px;" id="doc-viewer-content">
        <div class="input-group mt-2" id="content-selector-tool">
          <input type="text" id="content-search" class="form-control" placeholder="Find text within the page (f)" />
          <button type="button" class="btn btn-primary" id="content-search-btn" onclick="select_content()">
            <i class="fas fa-search"></i>
          </button>
        </div>
        <hr />

        <iframe class="mb-2" srcdoc='
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedded Page</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div style="margin-left:10px; margin-right:10px;">
      <p>Search to make a document appear!</p>
    </div>
  </body>
  </html>
' id="view-page-collapse"></iframe>
      </div>
    </div>
  </div>

  <script>
    function calculate() {
      const expression = document.getElementById('calc-expression').value;
      if (!expression) {
        document.getElementById('calc-result').textContent = "Please enter an equation.";
        return;
      }

      sendRequest("calculate", expression);
    }

    function web_search() {
      const query = document.getElementById('google-query').value;  // Get the expression from input field
      if (!query) {
        return;
      }
      sendRequest("web_search", query);
    }

    function select_content() {
      const query = document.getElementById('content-search').value;
      const doc_content = document.getElementById('view-page-collapse').srcdoc;
      const default_content = 'Search to make a document appear!';
      if (!query) {
        return;
      } else if (doc_content.includes(default_content)) {
        return;
      }

      sendRequest("content_select", query);
    }
  </script>

</body>

</html>
